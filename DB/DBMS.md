# DBMS

---

SQL의 성능을 이야기하는데 필요한 DBMS (Database Management System: 데이터페이스 관리 시스템)의 아키택처


#### 쿼리평가엔진
---
사용자로부터 입력받은 SQL 구문을 분석하고, 어떤 순서로 기억장치에 데이터에 접근할 지 결정한다.

이 때, 결정되는 계획을 **실행 계획 (또는 실행 플랜, Explain Plan)** 이라고 한다.

이러한 실행 계획에 기반을 둬서 데이터에 접근하는 방법을 **접근 메서드 (Access Method)** 라고 한다.

#### 버퍼 매니저
---
DBMS는 **버퍼** 라는 특별한 용도로 사용하는 메모리 영역을 확보하며 이를 관리하는 것은 버퍼 매니저의 역할이다.

> **버퍼:** 한 곳에서 다른 곳으로 데이터를 이동할 때 임시적으로 그 데이터를 저장하기 위해 사용되는 물리적인 메모리 저장소의 영역

![](https://w.namu.la/s/893cc4cb9901911dd7fbf7e151f8768f0a10d00d6b50bc9ad2b634810c19723f7c5464bc7701d8cfbfa7a4c3027ec10198c1cfcb92b598bd0eccea6202beb28abe0c1ee18ee77f4b8154f8be8d4911b95b28c9c3f3f77fb54ff9de0a47c611e8)

> 일반적으로 많은 데이터를 영속적으로 저장하려면 속도를 잃고, 속도를 얻고자 하면 많은 데이터를 영속적으로 저장하기 힘들다는 트레이드오프가 발생한다.

DBMS가 사용하는 대표적인 기억 장치는 크게 2가지
1. 하드디스크(HDD) (2차 기억장치)
2. 메모리 (1차 기억장치)

메모리는 디스크에 비해 기억 비용이 비싸다. 하지만 DBMS가 일부라도 데이터를 메모리에 올리는 것은 성능 향상, 즉 SQL 구문의 실행 속도를 빠르게 만들기 위함에 있다.

자주 접근하는 데이터를 메모리 위에 올려둔다면, 같은 SQL 구문을 실행한다고 해도 곧바로 메모리에서 읽어 빠르게 데이터를 검색할 수 있다. 이렇게 성능 향상을 목적으로 데이터를 저장하는 메모리를 **(로그) 버퍼(Buffer)** 또는 **(데이터) 캐시(cache)** 라고 부른다.

> **로그 버퍼는 갱신처리 (INSERT, DELETE, UPDATE, MERGE) 와 관련이 있다.** 해당 SQL 구문을 사용자로부터 받으면, 일단 로그 버퍼 위에 변경 정보를 보내고 이후 디스크에 변경을 수행한다. (SQL 구문의 실행 시점과 저장소에 갱신하는 시점에 차이가 있는 **비동기 처리**)

Q. 메모리의 데이터는 영속성이 없다. 즉, DBMS를 껐다 켜면 버퍼 위의 모든 데이터가 사라진다. 만약 로그 버퍼 위에 존재하는 데이터가 디스크 내의 데이터에 반영되기 전에 장애가 발생하여 사라진다면?

DBMS는 갱신 처리를 확정할 때, 즉 커밋(Commit) 시점에 갱신 정보를 로그 파일에 씀으로써, 장애가 발생해도 정합성을 유지할 수 있게 한다. 반대로 말하면 커밋 때는 반드시 디스크에 동기 접근이 일어난다.

> **데이터 캐시는 디스크에 있는 데이터의 일부를 메모리에 유지하기 위해 사용하는 메모리 영역이다.** 만약 SELECT 구문에서 선택하고 싶은 데이터가 운 좋게 모두 데이터 캐시에 있다면, 디스크에 접근하여 조회할 때보다 훨씬 빠르게 응답한다.

*기본적으로 검색 처리를 담당하는 **데이터 캐시** 의 영역이, 갱신을 담당하는 **로그 버퍼** 의 보다 크게 할당된다.* 그러나 검색과 갱신 중에 더 우선되는 것이 무엇인가에 따라 각각의 영역 크기는 조절될 수 있다.

이 외에도 DBMS는 일반적으로 메모리 영역을 하나 더 가지고 있다.

> **워킹 메모리 (Working memory) 는 정렬 또는 해시 관련 처리에 사용되는 영역이다.** 정렬은 ORDER BY 구, 집합 연산(GROUP BY, HAVING), 윈도우 함수 등의 기능을 사용할 때 실행되며, 해시는 주로 테이블 등의 결합에서 해시 결합이 사용될 때 실행된다.

버퍼 매니저는 또한 디스크를 관리하는 디스크 용량 매니저와 함께 연동되어 작동한다.

#### 디스크 용량 매니저
---
디스크 용량 매니저는 어디에 어떻게 데이터를 저장할지 관리하며, 데이터의 읽고 쓰기를 제어한다.

#### 트랜잭션 매니저 & 락 매니저
---
상용 시스템에서 데이터 베이스는 수많은 사용자의 접근을 처리해야 하는데, 각각의 처리는 DBMS 내부에서 트랜젝션이라는 단위로 관리된다.

이 트랜잭션의 정합성을 유지하며 실행시키고, 필요한 경우 데이터에 락을 걸어 다른 요청을 대기시키는 것이 트랜잭션 매니저와 락 매니저의 역할이다.

#### 리커버리 매니저
---
DBMS가 저장하고 있는 데이터 중에는 절대 잃어버리는 안되는 데이터가 있다. 이를 정기적으로 백업하고, 문제 상황 시 복구하는 기능을 수행하는 것이 리커버리 매니저의 역할이다.


---
Ref

- [나무위키 - 버퍼](https://namu.wiki/w/버퍼)
- [나무위키 - 캐시 메모리](https://namu.wiki/w/%EC%BA%90%EC%8B%9C%20%EB%A9%94%EB%AA%A8%EB%A6%AC)

# Explain plan

---

Q. 사용자로부터 입력받은 SQL 구문(Query)이 어떻게 처리되고, 실제로 데이터 접근은 어떻게 이루어질까?

> **1) Parser**

파서의 역할은 이름 그대로 파스(구문 분석)하는 것이다. 입력받은 쿼리문의 문법이 맞게 작성되었는지, 존재하지 않는 테이블이나 컬럼을 참조하고 있는지 등이 해당되며 일반 프로그래밍 언어의 컴파일 시점에서 실행되는 것이라 생각하자.

> **2) Optimizer (최적화)**

최적화의 대상은 데이터 접근법, 즉 실행 계획(Explain plan)이다.

인덱스 유무, 데이터 분산 또는 편향 정도, DBMS 내부 매개변수 등의 조건을 고려하여 **가능한 실행 계획들을 작성** 하고, **비용을 연산** 하여 **가장 낮은 비용을 가진 실행 계획을 선택** 한다.

> **3) Catelog manager**

Optimizer가 실행 계획을 세울 때 중요한 정보들을 제공하는 역할을 한다.

> **Catelog란?** DBMS의 내부 정보를 모아놓은 테이블들로, 테이블 또는 인덱스의 통계 정보가 저장되어 있어 '통계 정보'라고 부르기도 한다.

일반적인 통계 정보의 예로, 다음이 포함된다.
- 각 테이블의 레코드 수
- 각 테이블의 필드 수와 필드의 크기
- 필드의 Cardinality (값의 개수)
- 필드 값의 히스토그램 (어떤 값이 얼마나 분포되어 있는가?)
- 필드 내부의 NULL 개수
- 인덱스 정보
...

해당 통계 정보에 대해서는 DBA가 항상 신경써줘야 한다.

> **4) Plan evaluation**

 Optimizer가 세운 실행 결과들 중 최적의 실행 결과를 선택하는 단계이다.

 DBMS 종류에 따라 실행 계획을 조사하는 수단은 다음과 같다.

 | Oracle | MySQL | PostgreSQL | Microsoft SQL Server |
 | --- | --- | --- | --- |
 | set autotrace traceonly | EXPLAIN EXTENDED SQL 구문 | EXPLAIN SQL 구문 | SET SHOWPLAN_TEXT ON |
